@layer theme, base, components, utilities;
@import "tailwindcss/theme.css" layer(theme);
@import "tailwindcss/utilities.css" layer(utilities);

@layer components {
  /* WordPress Admin Container Constraints */
  .wrap .repeater,
  .postbox .repeater,
  .form-table .repeater {
    max-width: 100% !important;
    overflow-x: auto !important;
    box-sizing: border-box !important;
    margin-right: 20px !important;
  }

  /* Modern Table Design */
  .repeater {
    border-radius: 12px !important;
    overflow: visible !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;
    border: 1px solid #e5e7eb !important;
    background: white !important;
    padding: 20px !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }

  .repeater table {
    table-layout: auto !important;
    border-collapse: separate !important;
    border-spacing: 0 !important;
    background: white !important;
    width: 100% !important;
    max-width: 100% !important;
    border-radius: 8px !important;
    overflow: hidden !important;
    border: 1px solid #e5e7eb !important;
    display: table !important;
    box-sizing: border-box !important;
  }

  /* Modern table headers */
  .repeater table thead th {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
    border: none !important;
    border-bottom: 2px solid #e2e8f0 !important;
    padding: 16px 20px !important;
    font-weight: 600 !important;
    font-size: 14px !important;
    color: #334155 !important;
    text-align: left !important;
    letter-spacing: 0.025em !important;
  }

  .repeater table thead th:first-child {
    border-top-left-radius: 8px !important;
  }

  .repeater table thead th:last-child {
    border-top-right-radius: 8px !important;
  }

  /* Modern table cells */
  .repeater table tbody td {
    border: none !important;
    border-bottom: 1px solid #f1f5f9 !important;
    padding: 16px 20px !important;
    background: white !important;
    vertical-align: middle !important;
    transition: all 0.2s ease !important;
  }

  /* Hover effects for rows */
  .repeater table tbody tr:hover td {
    background: #f8fafc !important;
  }

  /* Last row styling */
  .repeater table tbody tr:last-child td {
    border-bottom: none !important;
  }

  /* Modern form inputs */
  .recursive-field input,
  .recursive-field textarea {
    width: 100% !important;
    border: 1px solid #e2e8f0 !important;
    border-radius: 8px !important;
    padding: 8px 12px !important;
    font-size: 14px !important;
    transition: all 0.2s ease !important;
    background: white !important;
    color: #374151 !important;
    min-width: 150px !important;
  }

  .recursive-field input:focus,
  .recursive-field textarea:focus {
    outline: none !important;
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }

  /* Tom-select styling */
  .ts-wrapper {
    display: inline-block !important;
    width: auto !important;
  }

  .ts-control {
    flex-direction: column !important;
    align-items: flex-start !important;
    width: auto !important;
    display: inline-flex !important;
    border: 1px solid #e2e8f0 !important;
    border-radius: 8px !important;
    background: white !important;
    box-shadow: none !important;
    transition: all 0.2s ease !important;
    min-width: 150px !important;
  }

  .ts-control:focus-within {
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }

  .ts-wrapper.multi .ts-control > div {
    margin: 2px 0 !important;
    width: fit-content !important;
    background: #f1f5f9 !important;
    border: 1px solid #e2e8f0 !important;
    border-radius: 6px !important;
    padding: 4px 8px !important;
    font-size: 12px !important;
    color: #475569 !important;
  }

  /* Remove Button Styling */
  .repeater table tbody td button {
    background: #ef4444 !important;
    color: white !important;
    border: none !important;
    border-radius: 6px !important;
    padding: 6px 12px !important;
    font-size: 12px !important;
    font-weight: 500 !important;
    transition: all 0.2s ease !important;
    cursor: pointer !important;
  }

  .repeater table tbody td button:hover {
    background: #dc2626 !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2) !important;
  }

  /* Add Row Button Styling */
  .repeater button {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
    color: white !important;
    border: none !important;
    border-radius: 8px !important;
    padding: 12px 24px !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    transition: all 0.2s ease !important;
    cursor: pointer !important;
    box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2) !important;
  }

  .repeater button:hover {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3) !important;
  }

  /* Table cells with tom-select fields size to their content */
  .repeater table td:has(.ts-wrapper) {
    width: 1% !important;
  }

  /* Fix first column width issue - only target tom-select fields */
  .repeater table td:first-child:has(.ts-wrapper) {
    width: 1% !important;
  }

  /* Actions column should have fixed width */
  .repeater table th:last-child,
  .repeater table td:last-child {
    width: 100px !important;
    min-width: 100px !important;
    max-width: 100px !important;
  }

  /* Ensure first column (text fields) size to content */
  .repeater table td:first-child:not(:has(.ts-wrapper)) {
    width: 1% !important;
  }

  /* First column text fields should size to content */
  .repeater table td:first-child:not(:has(.ts-wrapper)) input,
  .repeater table td:first-child:not(:has(.ts-wrapper)) textarea {
    width: auto !important;
    display: inline-block !important;
    overflow: visible !important;
  }

  .recursive-field,
  .recursive-field > div {
    display: inline-block !important;
    width: 100%;
  }

  /* But keep tom-select fields auto-width */
  .recursive-field:has(.ts-wrapper) input,
  .recursive-field:has(.ts-wrapper) textarea {
    width: auto !important;
    display: inline-block !important;
  }

  /* Ensure text fields without tom-select take full width */
  .recursive-field:not(:has(.ts-wrapper)) input,
  .recursive-field:not(:has(.ts-wrapper)) textarea {
    width: 100% !important;
    display: block !important;
  }

  /* Search field styling */
  .repeater .relative input[placeholder="Search rows..."] {
    width: 100% !important;
    padding: 12px 16px 12px 40px !important;
    border: 1px solid #d1d5db !important;
    border-radius: 8px !important;
    font-size: 14px !important;
    background: white !important;
    transition: all 0.2s ease !important;
    min-width: 200px !important;
  }
  
  /* WordPress Admin Responsive Adjustments */
  @media (max-width: 782px) {
    .repeater {
      padding: 15px !important;
      margin: 0 !important;
    }
    
    .repeater table {
      font-size: 13px !important;
    }
    
    .repeater table thead th,
    .repeater table tbody td {
      padding: 12px 8px !important;
    }
  }

  /* Responsive search field */
  @media (max-width: 640px) {
    .repeater .relative input[placeholder="Search rows..."] {
      min-width: 0 !important;
      font-size: 16px !important; /* Prevents zoom on iOS */
    }
    
    .repeater {
      padding: 10px !important;
    }
    
    .repeater table thead th,
    .repeater table tbody td {
      padding: 8px 4px !important;
      font-size: 12px !important;
    }
  }

  .repeater .relative input[placeholder="Search rows..."]:focus {
    outline: none !important;
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }

  .repeater .relative .absolute {
    left: 12px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    color: #6b7280 !important;
  }

  .submit-btn,
  .repeater button {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
    color: white !important;
    border: none !important;
    border-radius: 8px !important;
    padding: 12px 20px !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    transition: all 0.2s ease !important;
    cursor: pointer !important;
    box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2) !important;
    min-width: 80px !important;
  }

  .submit-btn:hover,
  .repeater button:hover {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3) !important;
  }
}